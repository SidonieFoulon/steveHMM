<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Sidonie Foulon, Thérèse Truong, Anne-Louise Leutenegger, Hervé Perdry" />


<title>steveHMM_vignette</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">steveHMM_vignette</h1>
<h4 class="author">Sidonie Foulon, Thérèse Truong, Anne-Louise
Leutenegger, Hervé Perdry</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><strong>steveHMM</strong> package contain several functions. The aim
is to estimate the Hidden Markov model (HMM) parameters via different
methods. The four main functions corresponds to four maximum likelihood
algorithms :<br />
</p>
<ul>
<li><strong>quasi_newton</strong> : direct maximisation of the
likelihood with a quasi-Newton algorithm (L-BFGS-B)<br />
</li>
<li><strong>EM</strong> : Baum-Welch algorithm, an
Expectation-Maximisation (EM) algorithm<br />
</li>
<li><strong>SQUAREM</strong> : Squared iterative method, an accelerated
EM algorithm (Varadhan, 2008)<br />
</li>
<li><strong>QNEM</strong> : our novel hybrid algorithm, combines the
Baum-Welch and quasi-Newton BFGS algorithm.<br />
</li>
</ul>
<p>These four functions will rely on two other functions that the users
must create depending on their HMM model : a function
<strong>model</strong>, used for all four main functions and a function
<strong>M-step</strong> used for all main functions except
<strong>quasi_newton</strong>.</p>
<p>We will show how to use each of these four functions on an
example.</p>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>We will use a simple example based on a fictitious situation. Every
day of the year, in a secret underground installation, a security guard
observes whether the director comes in with an umbrella or not (Gao,
2021). During 56 days, the security guard keep track of his observations
on his note pad as follows: U if the director carries an umbrella; N
otherwise.<br />
The guards aims to predict the daily weather conditions (hidden states)
based on the umbrella observations: rainy (noted R) or dry (noted D)
day. Here the hidden state is the weather.<br />
Since the security guard is in a underground installation, he can not
observe directly the weather: he has to rely only on his observations of
the umbrella status to determine the weather. The parameters to estimate
are <em>a</em> the probability of weather state transition and
<em>b</em> the probability of error in the umbrella status (not carrying
an umbrella on rainy day or carrying an umbrella on dry day). The
transition and emission matrix are presented respectively in the
following Tables.</p>
<table>
<thead>
<tr class="header">
<th align="center">Transition matrix</th>
<th align="center"><span class="math inline">\(S_i = D\)</span></th>
<th align="center"><span class="math inline">\(S_i = R\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(S_{i-1} = D\)</span></td>
<td align="center">1-a</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(S_{i-1} = R\)</span></td>
<td align="center">a</td>
<td align="center">1-a</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="center">Emission matrix</th>
<th align="center"><span class="math inline">\(S_i = D\)</span></th>
<th align="center"><span class="math inline">\(S_i = R\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(X_i = N\)</span></td>
<td align="center">1-b</td>
<td align="center">b</td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(X_i = U\)</span></td>
<td align="center">b</td>
<td align="center">1-b</td>
</tr>
</tbody>
</table>
<p>Here are the observations <em>X</em> for our example (1 code for “No
umbrella” and 2 for “Umbrella”) and the initial parameters
<em>par</em>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="fl">0.3</span>, <span class="at">b =</span> <span class="fl">0.15</span>)</span></code></pre></div>
</div>
<div id="model" class="section level1">
<h1>Model</h1>
<p>Before running our functions, we have to create the model of the
example. The function <strong>model</strong> takes the set of parameters
<em>theta</em>, the observations <em>obs</em> and the names of the
hidden states <em>name.S</em>. It returns in a list, the transition
matrix <em>trans</em>, the stationary probability <em>pi</em> and a
matrix of the emission probabilities for each observation
<em>p.emiss</em>.</p>
<p><em>trans</em> is constructed from the transition parameter
<em>a</em>. In this example, the stationary state does not depend on any
of the two parameters. For some examples, the stationary state may be
computed from the parameters. <em>p.emiss</em> is constructed from the
emission parameter <em>b</em>. It is a matrix of the same number of
columns as the length of <em>obs</em> (here 56) and one rows by hidden
state (here 2).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, obs, <span class="at">name.S =</span> <span class="fu">c</span>(<span class="st">&quot;Dry&quot;</span>, <span class="st">&quot;Rainy&quot;</span>)) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="co"># parameter of transition matrix </span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  a <span class="ot">&lt;-</span> theta[<span class="dv">1</span>]</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  trans <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>a, a, a, <span class="dv">1</span><span class="sc">-</span>a), <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">colnames</span>(trans) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(trans) <span class="ot">&lt;-</span> name.S</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="co"># stationary state</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  stat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="co"># parameter of emission matrix</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  b <span class="ot">&lt;-</span> theta[<span class="dv">2</span>]</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  p.emiss <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">ifelse</span>(obs <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span><span class="sc">-</span>b, b), <span class="fu">ifelse</span>(obs <span class="sc">==</span> <span class="dv">1</span>, b, <span class="dv">1</span><span class="sc">-</span>b))</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="fu">rownames</span>(p.emiss) <span class="ot">&lt;-</span> name.S</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="co">#return</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">trans =</span> trans, <span class="at">pi =</span> stat, <span class="at">p.emiss =</span> p.emiss)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">model</span>(<span class="at">theta =</span> par, <span class="at">obs =</span> X)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>mod</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; $trans</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt;       Dry Rainy</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; Dry   0.7   0.3</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt; Rainy 0.3   0.7</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; $pi</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; [1] 0.5 0.5</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; $p.emiss</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; Dry   0.85 0.85 0.15 0.15 0.15 0.15 0.15 0.15 0.15  0.85  0.15  0.15  0.15</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; Rainy 0.15 0.15 0.85 0.85 0.85 0.85 0.85 0.85 0.85  0.15  0.85  0.85  0.85</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt;       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; Dry    0.85  0.15  0.15  0.85  0.85  0.85  0.85  0.85  0.85  0.85  0.85  0.85</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; Rainy  0.15  0.85  0.85  0.15  0.15  0.15  0.15  0.15  0.15  0.15  0.15  0.15</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;       [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt; Dry    0.15  0.85  0.85  0.85  0.85  0.85  0.85  0.85  0.15  0.85  0.85  0.85</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt; Rainy  0.85  0.15  0.15  0.15  0.15  0.15  0.15  0.15  0.85  0.15  0.15  0.15</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;       [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; Dry    0.15  0.15  0.15  0.85  0.15  0.15  0.85  0.15  0.15  0.85  0.15  0.15</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt; Rainy  0.85  0.85  0.85  0.15  0.85  0.85  0.15  0.85  0.85  0.15  0.85  0.85</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt;       [,50] [,51] [,52] [,53] [,54] [,55] [,56]</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt; Dry    0.15  0.15  0.15  0.85  0.15  0.15  0.15</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; Rainy  0.85  0.85  0.85  0.15  0.85  0.85  0.85</span></span></code></pre></div>
</div>
<div id="m-step" class="section level1">
<h1>M-step</h1>
<p>The M-step corresponds to the maximisation step of the EM algorithm.
This step depends on the model so can not be generalised, on the
contrary of the E-step. The <strong>M.step</strong> function takes the
observations <em>obs</em> and the backward results <em>backward</em>
from the forward-backward algorithm used in E-step. The backward can be
computed with the <strong>backward</strong> function of the
<strong>steveHMM</strong> package. This function takes the results of
the <strong>forward</strong> algorithm, obtained with the so-called
function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(steveHMM)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fw <span class="ot">&lt;-</span> <span class="fu">forward</span>(<span class="at">modele =</span> mod)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">backward</span>(<span class="at">modele =</span> fw)</span></code></pre></div>
<p>Here is how is constructed a M-step function. The parameter
<em>a</em> corresponds to the probability of change in the hidden state,
ie. switching from a dry day to a rainy day and vice versa. In the
results of the backward algorithm, <span class="math inline">\(\delta_i(s,t) = \mathbb{P}_{\theta}(S_{i-1}=s,
S_i=t | X_1^{L} = x_1^{L})\)</span>. The probability of change will be
the sum of prbablities <span class="math inline">\(\delta_i(D,R)\)</span> and <span class="math inline">\(\delta_i(R,D)\)</span> on the total number of
transitions. For the parameter <em>b</em>, the parameter of error in the
umbrella status, ie. bringing an umbrella on a dry day or forget it on a
rainy day, we will use another backward algorithm result. We rely here
on the probability <span class="math inline">\(\varphi_i(s) =
\mathbb{P}_{\theta}(S_i=s | X_1^{L} = x_1^{L})\)</span>. To estimate
<em>b</em>, we sum the probabilities <span class="math inline">\(\varphi_i(R)\)</span> only on the observations
coded 1 for “No umbrella”, and <span class="math inline">\(\varphi_i(D)\)</span> only on the observations
coded 2 for “Umbrella”, divided by the total number of observations.</p>
<p>The <strong>M.step</strong> function returns the re-estimated
parameters.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>M.step <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, backward) {</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">ncol</span>(backward<span class="sc">$</span>phi)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="co"># parameter a</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  a <span class="ot">&lt;-</span> (<span class="fu">sum</span>(backward<span class="sc">$</span>delta[<span class="dv">1</span>,<span class="dv">2</span>,] <span class="sc">+</span> backward<span class="sc">$</span>delta[<span class="dv">2</span>,<span class="dv">1</span>,]))<span class="sc">/</span>(l<span class="dv">-1</span>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="co"># parameter b</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="fu">sum</span>(backward<span class="sc">$</span>phi[<span class="dv">2</span>,<span class="fu">which</span>(obs <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">+</span> <span class="fu">sum</span>(backward<span class="sc">$</span>phi[<span class="dv">1</span>,<span class="fu">which</span>(obs <span class="sc">==</span> <span class="dv">2</span>)]))<span class="sc">/</span>l</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">c</span>(a,b)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>}</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>Mstep <span class="ot">&lt;-</span> <span class="fu">M.step</span>(<span class="at">obs =</span>X, <span class="at">backward =</span> bw)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>Mstep</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; [1] 0.2570231 0.1357748</span></span></code></pre></div>
</div>
<div id="quasi_newton-function" class="section level1">
<h1>quasi_newton function</h1>
<p>The <strong>quasi_newton</strong> function let us estimate the HMM
parameters with direct maximisation of the likelihood. We use a
quasi-Newton type method called L-BFGS-B. In this function we are using
the R function <strong>optim</strong>. <strong>quasi_newton</strong>
function takes the initial parameters <em>theta</em>, the observations
<em>obs</em>, the model function previously constructed in
<em>modele.fun</em>. If you want to keep track of the different
estimations of the parameters, you can use the argument <em>trace</em>.
You can also add the arguments specific to the <strong>optim</strong>
function. Here we added the arguments <em>lower</em> and <em>upper</em>
related to the bounds for the estimations of the parameters <em>a</em>
and <em>b</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>qn <span class="ot">&lt;-</span> <span class="fu">quasi_newton</span>(<span class="at">theta =</span> par, <span class="at">obs =</span> X, <span class="at">modele.fun =</span> model, <span class="at">trace =</span> <span class="cn">TRUE</span>, <span class="at">lower =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.01</span>), <span class="at">upper =</span> <span class="fu">c</span>(<span class="fl">0.99</span>,<span class="fl">0.99</span>))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; theta = 0.3 0.15 </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; theta = 0.01 0.01 </span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; theta = 0.1996165 0.101539 </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; theta = 0.1079778 0.1201175 </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; theta = 0.01 0.1399812 </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; theta = 0.06933546 0.1279517 </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; theta = 0.01 0.198636 </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; theta = 0.0475364 0.1539202 </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; theta = 0.177374 0.3256689 </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; theta = 0.06671876 0.1792946 </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; theta = 0.06060222 0.1797503 </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; theta = 0.05797894 0.1804667 </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; theta = 0.05837474 0.180494 </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; theta = 0.05835937 0.1805199 </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; theta = 0.05835856 0.1805252</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>qn</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt;          a          b </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 0.05835856 0.18052518 </span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; [1] 33.33029</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt;       15       15 </span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt; [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; $forwards</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt; [1] 15</span></span></code></pre></div>
<p>This function returns the same output as the <strong>optim</strong>
function, more the number of forward algorithm calls.</p>
</div>
<div id="em-function" class="section level1">
<h1>EM function</h1>
<p>With this function, we can apply the Baum-Welch algorithm, a variant
of the EM algorithm. <strong>EM</strong> function takes the initial
parameters <em>theta</em>, the observations <em>obs</em>, the model and
M.step functions previously constructed in respectively
<em>modele.fun</em> and <em>M.step.fun</em>. There also are optional
arguments such as <em>max.iter</em> to bound the number of iterations of
the algorithm or <em>trace.theta</em> to keep track of the different
estimations of the parameters. By default, the stopping criterion is
<em>reltol</em>, but it can be switched to a threshold stopping
criterion with “<em>criteria</em> = ‘epsilon’”.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>em <span class="ot">&lt;-</span> <span class="fu">EM</span>(<span class="at">theta =</span> par, <span class="at">obs =</span> X, <span class="at">modele.fun =</span> model, <span class="at">M.step.fun =</span> M.step, <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="at">trace.theta =</span> <span class="cn">TRUE</span>, <span class="at">criteria =</span> <span class="st">&quot;reltol&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>em</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; $theta</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; [1] 0.05836476 0.18052001</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; $iter</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; [1] 19</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; $likelihood</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; [1] -33.33029</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; $Theta</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;   [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]       [,8]</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; a 0.30 0.2570231 0.2210793 0.1894319 0.1590349 0.1294743 0.1032486 0.08351332</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; b 0.15 0.1357748 0.1302585 0.1329438 0.1409980 0.1512081 0.1608406 0.16832386</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;        [,9]      [,10]      [,11]      [,12]      [,13]      [,14]     [,15]</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; a 0.0711647 0.06451304 0.06123951 0.05969485 0.05897718 0.05864508 0.0584914</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; b 0.1734353 0.17664272 0.17850848 0.17951929 0.18003717 0.18029255 0.1804155</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;        [,16]     [,17]      [,18]      [,19]</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; a 0.05842021 0.0583872 0.05837188 0.05836476</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; b 0.18047378 0.1805012 0.18051402 0.18052001</span></span></code></pre></div>
<p>The function returns a list with the final estimation of the
parameters <em>theta</em>, the number of iterations <em>iter</em>, the
<em>likelihood</em> and if the <em>trace.theta</em> option is on, the
track of all parameters estimated in <em>Theta</em>.</p>
</div>
<div id="squarem-function" class="section level1">
<h1>SQUAREM function</h1>
<p>The SQUAREM function is used to apply the accelerated EM algorithm
SQUAREM. Its arguments are the same as <strong>EM</strong> function. You
can also bound the space of parameters with <em>lower</em> and
<em>upper</em> arguments.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>squarem <span class="ot">&lt;-</span> <span class="fu">SQUAREM</span>(<span class="at">theta =</span> par, <span class="at">obs =</span> X, <span class="at">modele.fun =</span> model, <span class="at">M.step.fun =</span> M.step, <span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="at">trace.theta =</span> <span class="cn">TRUE</span>, <span class="at">criteria =</span> <span class="st">&quot;reltol&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>squarem</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; $theta</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; [1] 0.0583517 0.1805286</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; $iter</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; [1] 23</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; $forwards</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; [1] 15</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; $backwards</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; [1] 15</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; $likelihood</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; [1] -33.33029</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; $Theta</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;   [,1]      [,2]      [,3]      [,4]      [,5]       [,6]       [,7]       [,8]</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt; a 0.30 0.2570231 0.2210793 0.1413800 0.1130972 0.09042448 0.04484709 0.05282006</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt; b 0.15 0.1357748 0.1302585 0.1485454 0.1577627 0.16583592 0.18547970 0.18409793</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;         [,9]      [,10]      [,11]      [,12]      [,13]      [,14]      [,15]</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; a 0.05591687 0.05478473 0.05682613 0.05767483 0.05742972 0.05795776 0.05817972</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; b 0.18239221 0.18172132 0.18140283 0.18100583 0.18078268 0.18073582 0.18064512</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="co">#&gt;        [,16]      [,17]      [,18]      [,19]     [,20]     [,21]     [,22]</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; a 0.05811869 0.05825513 0.05831248 0.05829666 0.0583319 0.0583467 0.0583426</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt; b 0.18058385 0.18057717 0.18055544 0.18053958 0.1805384 0.1805329 0.1805289</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt;       [,23]</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; a 0.0583517</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; b 0.1805286</span></span></code></pre></div>
<p>Additional to the values returned by the <strong>EM</strong>
function, <strong>SQUAREM</strong> returns the number of
<em>forward</em> and <em>backward</em> algorithms performed.</p>
</div>
<div id="qnem-function" class="section level1">
<h1>QNEM function</h1>
<p>The last function, we are presenting here is the
<strong>QNEM</strong> function, an implementation of our algorithm which
mix the Baum-Welch EM and the quasi-Newton BFGS algorithms. The
mandatory arguments are the same as the <strong>EM</strong> function.
Yet, you can also add some optional arguments, such as those used by the
<strong>SQUAREM</strong> function, but also you can set the number of
Baum-Welch algorithm to perform before switching to BFGS algorithm
(here, we chose 3, ie. the algorithm will perform 3 iterations of the
Baum-Welch algorithm, then only the BFGS algorithm, unless the curvature
condition is not met anymore). To display information while running the
algorithm, you can add “<em>verbose</em> = TRUE”.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>qnem <span class="ot">&lt;-</span> <span class="fu">QNEM</span>(<span class="at">theta =</span> par, <span class="at">obs =</span> X, <span class="at">modele.fun =</span> model, <span class="at">M.step.fun =</span> M.step, <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="at">upper =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">lower =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">trace.theta =</span> <span class="cn">TRUE</span>, <span class="at">nb.em =</span> <span class="dv">3</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; number of EM iterations determined by user</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; EM step</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; locally convex region</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; theta = 0.2570231 0.1357748 </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 35.57486 </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; EM step</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; locally convex region</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; theta = 0.2210793 0.1302585 </span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 35.20376 </span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; EM step</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; theta = 0.1894319 0.1329438 </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 34.86511 </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; backtracking</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; theta = 0.09471594 0.1325827 </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.83628 </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; backtracking</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; theta = 0.04735797 0.1374389 </span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.69351 </span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; theta = 0.06971422 0.1479469 </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.49809 </span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt; theta = 0.06553419 0.1621305 </span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.38427 </span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt; theta = 0.05797308 0.1785805 </span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.33088 </span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt; theta = 0.05820148 0.1802125 </span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.33031 </span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt; theta = 0.05835709 0.1805222 </span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt; neg log likelihood = 33.33029 </span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt; QN</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>qnem</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt; $theta</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt;            [,1]</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt; [1,] 0.05835859</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt; [2,] 0.18052521</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt; $neg.ll</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt; [1] 33.33029</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt; $iter</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt; [1] 12</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt; $forwards</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="co">#&gt; [1] 14</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt; $backwards</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co">#&gt; $Theta</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="co">#&gt;   [,1]      [,2]      [,3]      [,4]       [,5]       [,6]       [,7]</span></span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a><span class="co">#&gt; a 0.30 0.2570231 0.2210793 0.1894319 0.09471594 0.04735797 0.06971422</span></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a><span class="co">#&gt; b 0.15 0.1357748 0.1302585 0.1329438 0.13258268 0.13743890 0.14794692</span></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a><span class="co">#&gt;         [,8]       [,9]      [,10]      [,11]      [,12]</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a><span class="co">#&gt; a 0.06553419 0.05797308 0.05820148 0.05835709 0.05835859</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a><span class="co">#&gt; b 0.16213046 0.17858052 0.18021247 0.18052224 0.18052521</span></span></code></pre></div>
<p>The function returns the same output as the <strong>SQUAREM</strong>
function.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
